<html>
<head>
  <title>AngularJSのWatch数が60,000だった - @yoshiko_pg</title>
  <link rel="stylesheet" href="lib/talkie.min.css">
  <link rel="stylesheet" href="lib/talkie-default.min.css">
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="lib/hljs-styles/railscasts.css">
</head>
<body>


<script layout="cover" invert type="text/x-markdown"
  backface="image/cover.jpg" backface-filter="blur(2px) brightness(.7)">
# AngularJSのWatch数が60,000だった

2015.10.15 [@yoshiko_pg](http://yoshiko-pg.github.io)

[Goodpatch Engineer Meetup Vol.1](http://goodpatch.connpass.com/event/20857/)
</script>


<script layout="bullets" invert type="text/x-markdown"
  backface="image/bg-profile.png" backface-filter="blur(2px) brightness(.4)">

## 自己紹介

<img src="./image/yoshiko.png" class="yoshiko">

よしこ [@yoshiko_pg](https://twitter.com/yoshiko_pg)

Frontend engineer at <a href="http://goodpatch.com/jp"><img src="./image/goodpatch.png" class="company-logo"></a>

</script>


<script layout="bullets" type="text/x-markdown" class="m0">
### 今日話すこと

　

* AngularJSのパフォーマンスを改善した思い出
  * Watch数を減らすのに有効な施策
  * 重くなりがちなアンチパターン
</script>


<script layout type="text/x-markdown" class="m0">
2015年6月1日

　

フロントエンドエンジニアとしてGoodpatchに入社しました
</script>


<script layout="cover" invert type="text/x-markdown"
  backface="image/prott.png" backface-filter="">
</script>


<script layout="bullets" type="text/x-markdown">
## Prott

* Web App
* iOS App
* Android App
* Mac App
</script>


<script layout="bullets" type="text/x-markdown">
## Prott Web

* AngularJS
* CoffeeScript
* Jade
* Sass (SCSS)
</script>


<script layout="bullets-invert" type="text/x-markdown">
## 入社して最初のミッション
</script>


<script layout="bullets" type="text/x-markdown">
## 「Prott重いんだよね」
</script>


<script layout="bullets" type="text/x-markdown">
## 「パフォーマンスチューニングよろしく！」
</script>


<script layout="bullets-invert" type="text/x-markdown"
  backface="image/nya.jpg" backface-filter="blur(1px) brightness(.5)">
## なるほど
</script>


<script layout="bullets" type="text/x-markdown">
## とりあえず現状把握
</script>


<script layout="bullets" type="text/x-markdown">
Angularが重くなる代表的な原因のひとつ

　

### Watch多すぎ問題
</script>

<!--
ここに双方向バインディングとダイジェストループの説明入れるか悩む。
-->


<script layout="bullets" type="text/x-markdown">
指標としては2,000個以下に保っておきたいところ

*[AngularJSのパフォーマンス改善入門](http://qiita.com/zoetro/items/5156aef51222e81dd022)*
</script>


<script layout="bullets" type="text/x-markdown">
Watch数調査にはChrome拡張を使用すると便利
</script>


<script layout="bullets" type="text/x-markdown">
### [Angular watchers](https://chrome.google.com/webstore/detail/angular-watchers/nlmjblobloedpmkmmckeehnbfalnjnjk)

調べたいページで開発者ツールのタブを開くだけで
Watch数がわかるすぐれもの  
　  
潔いほどの単機能
</script>


<script layout="bullets" type="text/x-markdown">
### [AngularJS Batarang](https://chrome.google.com/webstore/detail/angularjs-batarang/ighdmehidhipcmcojjgiloacoafjmpfk)

こっちはとても有名なんですが  
去年辺りから使えないようです
</script>


<script layout="bullets-invert" type="text/x-markdown">
## いざ調査！
</script>


<script layout="bullets" type="text/x-markdown">
## 特に重かった画面

* プロジェクト一覧画面
* グループ機能画面
</script>


<script layout="bullets" type="text/x-markdown">
## プロジェクト一覧画面
## Watch数 **19,000**

*※プロジェクト200件表示時*
</script>


<script layout="bullets" type="text/x-markdown">
## グループ画面
## Watch数 **60,000**

*※メンバー◯名・プロジェクト◯個*
</script>


<script layout="bullets-invert" type="text/x-markdown"
  backface="image/nya.jpg" backface-filter="blur(1px) brightness(.5)">
## どうしてこうなった
</script>


<script layout="bullets" type="text/x-markdown">
### 入社5日目の日報

![](image/nippou.png)
</script>


<script layout="bullets-invert" type="text/x-markdown">
なにはともあれ
膨らんだWatch数を減らすには
</script>


<script layout="cover" invert type="text/x-markdown"
  backface="image/don.jpg" backface-filter="blur(2px) brightness(.4)">
#  One Time Binding
</script>


<script layout type="text/x-markdown">
##  One Time Binding

* 一度Watch対象の値を認識したら、  
それ以降の監視を行わない機能。  
* 一度決まれば二度と変動しない値に使用することで  
パフォーマンスを改善できる

※ ただし使えるのはAngularJS 1.3以降
</script>


<script layout="bullets" type="text/x-markdown">
当時のProttはAngularJS 1.2
</script>


<script layout="bullets-invert" type="text/x-markdown"
  backface="image/nya.jpg" backface-filter="blur(1px) brightness(.5)">
## だめじゃん
</script>


<script layout="bullets" type="text/x-markdown">
ということで最初の仕事は  
AngularJSのバージョンアップになりました
</script>


<script layout="bullets-invert" type="text/x-markdown">
### AngularJS 1.2 → 1.3 の注意点

* ``'false'`` ``'0'`` ``'no'`` ``'n'`` ``'f'`` ``'[]'`` がfalsyでなくなる
  * JS同様、``false`` ``null`` ``undefined`` ``NaN`` ``0`` ``""`` のみ falsyに
* $animateの仕様変更によりCSSにも修正が必要
* Directiveのreplaceが非推奨に
* IE8が対象外に

*その他：[AngularJS: Migrating from 1.2 to 1.3 日本語訳](http://angularjsninja.com/blog/2014/10/15/migrating-from-1.2-to-1.3-in-Japanese/)*
</script>


<script layout="bullets" type="text/x-markdown">
意外とすんなり上げられました  


むしろ同時にCoffeeScriptのバージョンを  
上げたことによるエラーの方が多かった
</script>


<script layout="bullets" type="text/x-markdown">
## 言語とフレームワーク

## 同時アップグレード  ダメ絶対

*切り分けが面倒なので*
</script>


<script layout="bullets-invert" type="text/x-markdown">
### One Time Bindingの適用
</script>

<!--
* Angular Translateにあてる
* 2画面のWatch数比較
* ng-repeatのイベントまとめる
* 2画面のWatch数比較
* まとめ
  * 上の施策が有効
-->


<script layout="cover" invert type="text/x-markdown"
  backface="image/don.jpg" backface-filter="blur(2px) brightness(.4)">
##  なんか背景
</script>


<script layout="bullets" type="text/x-markdown">
## なんかまとめ
</script>


<script layout="cover" invert type="text/x-markdown"
  backface="image/end.gif" backface-filter="blur(3px) brightness(.4)">
# Thank you
[@yoshiko_pg](http://yoshiko-pg.github.io/)
</script>


<script layout="bullets-invert" type="text/x-markdown">
# おまけ
</script>




<script src="lib/highlight.min.js"></script>
<script src="lib/talkie.min.js"></script>
<script>
Talkie();

// リンクは別タブ
var i, links = document.querySelectorAll("a[href^='http']")
for(i=0; i<links.length; i++) {
  links[i].setAttribute('target', '_blank');
}
</script>
</script>
</body>
</html>
